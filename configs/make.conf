# RaptorOS make.conf - Modern Gentoo Gaming Distribution
# Based on enhancement_4.md recommendations

# ============================================================================
# CORE COMPILER SETTINGS
# ============================================================================

# Use GCC 14.3.0 (already stable and cutting-edge!)
CC="gcc"
CXX="g++"

# Aggressive optimization flags for gaming performance
CFLAGS="-O3 -march=native -pipe -flto=auto -fno-plt -fdevirtualize-at-ltrans -fipa-pta -fuse-linker-plugin"
CXXFLAGS="${CFLAGS}"
LDFLAGS="-Wl,-O3 -Wl,--as-needed -Wl,-z,now -Wl,-z,relro -flto=auto"

# ============================================================================
# PACKAGE FEATURES
# ============================================================================

# Essential USE flags for gaming
USE="
    # Core system
    systemd udev dbus elogind
    # Graphics and gaming
    vulkan opengl gles2 vaapi vdpau
    # Audio
    pulseaudio pipewire jack
    # Performance
    lto pgo pgo-lto
    # Security
    hardened
    # Gaming specific
    gamemode mangohud
    # Optional: Wayland support
    wayland
"

# ============================================================================
# VIDEO CARDS
# ============================================================================

# Auto-detect and configure
VIDEO_CARDS="
    # NVIDIA (primary gaming choice)
    nvidia
    # AMD (excellent open source support)
    amdgpu radeonsi
    # Intel (integrated graphics)
    i915 xe
"

# ============================================================================
# CPU FLAGS
# ============================================================================

# Enable all CPU optimizations
CPU_FLAGS_X86="
    aes avx avx2 f16c fma3 mmx mmxext popcnt sse sse2 sse3 sse4_1 sse4_2 ssse3
    # Modern extensions
    avx512f avx512dq avx512cd avx512bw avx512vl
    # Security
    sha_ni
"

# ============================================================================
# LINGUAS
# ============================================================================

LINGUAS="en en_US"

# ============================================================================
# PORTAGE SETTINGS
# ============================================================================

# Parallel compilation for faster builds
# Using static values for compatibility with /bin/sh
MAKEOPTS="-j8 -l8"

# Binary packages for faster installation
FEATURES="
    parallel-install
    parallel-fetch
    getbinpkg
    binpkg-logs
    sign
    strict-keepdir
    userfetch
    usersync
"

# Binary package settings
BINPKG_FORMAT="gpkg"
BINPKG_COMPRESS="lz4"

# ============================================================================
# GENTOO MIRRORS
# ============================================================================

# Fast mirrors for gaming packages
GENTOO_MIRRORS="
    https://mirror.bytemark.co.uk/gentoo/
    https://mirror.leaseweb.com/gentoo/
    https://mirror.rise.ph/gentoo/
    https://mirror.telepoint.bg/gentoo/
    https://mirror.yandex.ru/gentoo-distfiles/
"

# ============================================================================
# ACCEPT KEYWORDS
# ============================================================================

# Minimal testing approach - most packages are already cutting-edge in stable
# Only enable testing for gaming-specific packages that need latest versions
ACCEPT_KEYWORDS="~amd64"

# ============================================================================
# PACKAGE ENVIRONMENT
# ============================================================================

# Apply modern optimizations to specific packages
# These will use the configs/env/* files we created
PACKAGE_ENV="
    media-libs/mesa llvm20-mesa25
    sys-devel/gcc gcc14-latest
    >=x11-drivers/nvidia-drivers-570 nvidia-modern
    sys-apps/systemd systemd-modern
"

# ============================================================================
# EMERGE DEFAULTS
# ============================================================================

# Smart emerge defaults for gaming
EMERGE_DEFAULT_OPTS="
    --keep-going
    --with-bdeps=y
    --backtrack=30
    --autounmask-write
    --autounmask-continue
"

# ============================================================================
# GAMING SPECIFIC SETTINGS
# ============================================================================

# Wine/Proton settings
WINE_ESYNC="1"
WINE_FSYNC="1"

# Steam settings
STEAM_RUNTIME="1"

# GameMode settings
GAMEMODE_CPU_GOVERNOR="performance"
GAMEMODE_GPU_POWERMODE="performance"

# ============================================================================
# SECURITY SETTINGS
# ============================================================================

# Hardened toolchain
GCC_CONFIG="gcc-config"
BINUTILS_CONFIG="binutils-config"

# ============================================================================
# DEVELOPMENT SETTINGS
# ============================================================================

# Development tools
USE="${USE} debug"

# Python settings
PYTHON_TARGETS="python3_11 python3_12"
PYTHON_SINGLE_TARGET="python3_11"

# Rust settings
RUST_TARGET="x86_64-unknown-linux-gnu"

# ============================================================================
# MONITORING AND LOGGING
# ============================================================================

# Portage logging
PORTAGE_ELOG_SYSTEM="save"
PORTAGE_ELOG_MAILURI=""

# ============================================================================
# BACKUP AND RECOVERY
# ============================================================================

# World file backup
PORTAGE_BACKUP_CONFIG="yes"

# ============================================================================
# SYNC CONFIGURATION
# ============================================================================

# Force git sync instead of rsync for better reliability
PORTAGE_SYNC_STALE=0
PORTAGE_SYNC_EXTRA_OPTS="--git"

# ============================================================================
# COMMENTS AND NOTES
# ============================================================================

# This configuration provides:
# - Maximum gaming performance with modern stable Gentoo
# - Minimal testing packages (only gaming essentials)
# - Aggressive compiler optimizations
# - Modern toolchain (GCC 14.3, LLVM 20, Mesa 25)
# - Gaming-specific optimizations
# - Security hardening
# - Fast binary package support

# To apply this configuration:
# 1. Copy this file to /etc/portage/make.conf
# 2. Copy the configs/repos.conf to /etc/portage/repos.conf
# 3. Copy the configs/env/* files to /etc/portage/env/
# 4. Copy the configs/package.accept_keywords/* to /etc/portage/package.accept_keywords/
# 5. Copy the configs/package.env/* to /etc/portage/package.env/
# 6. Run: emerge --sync && emerge -avuDN @world
